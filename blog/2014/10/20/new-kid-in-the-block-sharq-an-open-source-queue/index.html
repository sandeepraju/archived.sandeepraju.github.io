
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>New kid in the block: SHARQ - An Open Source, Rate Limited, Queueing System - Sandeep Raju</title>
	<meta name="author" content="Sandeep Raju">

	
	<meta name="description" content="I have been fascinated about task queues since my college days. The way they are designed &amp; work has always interested me. Being a Pythonista, I &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Sandeep Raju" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>

</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Sandeep Raju</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About Me</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About Me</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:sandeepraju.in">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/105104202775274439477?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/sandeeprajup" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/sandeepraju" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:sandeepraju.in">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">New Kid in the Block: SHARQ - an Open Source, Rate Limited, Queueing System</h2>
	<div class="entry-content"><p>I have been fascinated about task queues since my college days. The way they are designed &amp; work has always interested me. Being a Pythonista, I have been using <a href="">Celery</a> for a long time. <a href="https://twitter.com/asksol">Ask</a> has done an amazing job building Celery and the ecosystem around it. It works great for general use-cases faced by a lot of companies in their day to day workflows (like sending out emails in the background, running periodic tasks, so on). However, sometimes that doesn&rsquo;t suffice.</p>

<!-- more -->


<p>Recently, I faced an unique situation. I had to rate limit the queues in a specific system. Having used Celery for quite a few years, it was my natural choice. But soon, I realized that creating queues dynamically is not possible with Celery. Celery also lacked a clean way to <a href="http://celery.readthedocs.org/en/latest/userguide/tasks.html#Task.rate_limit">update the rate limit of a queue globally</a>. This was not acceptable for my use case.</p>

<p>All my efforts at searching for a queue with this specific feature set (dynamic queues, realtime rate limits &amp; constant flow rate) resulted in scripts and hacks written by several people, around various existing systems that were not built for this use case. It was apparent after some time that there was no simple, out of the box, cleaner solution for this problem and there was a scope for filling this void. This is how SHARQ came into existence.</p>

<p>SHARQ bridges this void in a simple and elegant manner by supporting all the above mentioned features. It is built using <a href="http://www.python.org/">Python</a> (<a href="http://flask.pocoo.org/">Flask</a> &amp; <a href="http://www.gevent.org/">Gevent</a>) and uses <a href="http://redis.io/">Redis</a> as a broker. It talks HTTP with JSON payloads which makes writing workers in any language easy.</p>

<p>SHARQ can be installed from <a href="https://pypi.python.org/pypi">PyPI</a> using the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install sharq-server
</span></code></pre></td></tr></table></div></figure>


<p>Once SHARQ is installed, it will expose a <strong>sharq-server</strong> command. The command is minimal and accepts a SHARQ configuration file. To get started quickly, grab the SHARQ <a href="https://raw.githubusercontent.com/plivo/sharq-server/master/sharq.conf">sample configuration file from here</a>. The SHARQ Server can be started with the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sharq-server --config sharq.conf
</span></code></pre></td></tr></table></div></figure>


<p>and you&rsquo;ll see SHARQ server running in foreground&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   ___ _              ___    ___
</span><span class='line'>  / __| |_  __ _ _ _ / _ <span class="se">\ </span> / __| ___ _ ___ _____ _ _
</span><span class='line'>  <span class="se">\_</span>_ <span class="se">\ </span><span class="s1">&#39; \/ _` | &#39;</span>_| <span class="o">(</span>_<span class="o">)</span> | <span class="se">\_</span>_ <span class="se">\/</span> -_<span class="o">)</span> <span class="s1">&#39;_\ V / -_) &#39;</span>_|
</span><span class='line'>  |___/_||_<span class="se">\_</span>_,_|_|  <span class="se">\_</span>_<span class="se">\_\ </span>|___/<span class="se">\_</span>__|_|  <span class="se">\_</span>/<span class="se">\_</span>__|_|
</span><span class='line'>
</span><span class='line'>Version: 0.1.0
</span><span class='line'>
</span><span class='line'>Listening on: 127.0.0.1:8080
</span></code></pre></td></tr></table></div></figure>


<p>Now, you can play around with SHARQ using its <a href="http://sharq.io/docs/apireference.html">REST APIs</a>.To know more about how to use SHARQ and its enqueue-dequeue-finish workflow, checkout the <a href="http://sharq.io/docs/gettingstarted.html">getting started section on sharq.io</a>.</p>

<p>SHARQ is open source and is <a href="https://github.com/plivo/sharq-server">available on Github</a>. Pull requests are always welcome!</p>

<p><strong>FURTHER READING</strong>:</p>

<ul>
<li><a href="http://sharq.io/docs">The SHARQ docs</a></li>
<li><a href="https://speakerdeck.com/sandeepraju/sharq-an-open-source-rate-limited-queueing-system-pycon-india-2014">SHARQ at PyCon India 2014</a></li>
<li><a href="https://github.com/sandeepraju/PyCon-India-2014">SHARQ resources of the PyCon talk</a></li>
<li>SHARQ example <a href="https://gist.github.com/sandeepraju/bfa72c7027e1d739b33e">Enqueue</a> and <a href="https://gist.github.com/sandeepraju/3da0ad035aa9bf5504b1">Dequeue</a> gists</li>
<li><a href="https://www.plivo.com/blog/sharq-a-flexible-open-source-rate-limited-queuing-system/">SHARQ on Plivo&rsquo;s blog</a></li>
</ul>


<p><strong>NOTE</strong>: I am the primary author of SHARQ and will be maintaining it constantly with features and bug fixes. SHARQ was written at <a href="https://www.plivo.com/">Plivo</a>. All the views and opinions expressed in this article are my own and does in no way reflect that of Plivo or any other entity.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-10-20T08:08:00+00:00" pubdate data-updated="true">Oct 20<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/dev/'>dev</a>, <a class='category' href='/blog/categories/flask/'>flask</a>, <a class='category' href='/blog/categories/gevent/'>gevent</a>, <a class='category' href='/blog/categories/lua/'>lua</a>, <a class='category' href='/blog/categories/msgpack/'>msgpack</a>, <a class='category' href='/blog/categories/opensource/'>opensource</a>, <a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/queue/'>queue</a>, <a class='category' href='/blog/categories/redis/'>redis</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	</div>
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Sandeep Raju

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'sandeepraju';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sandeepraju.in/blog/2014/10/20/new-kid-in-the-block-sharq-an-open-source-queue/';
        var disqus_url = 'http://sandeepraju.in/blog/2014/10/20/new-kid-in-the-block-sharq-an-open-source-queue/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-34261218-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
